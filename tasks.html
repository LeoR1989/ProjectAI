<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>任务中心 - 游戏平台</title>
  <link rel="stylesheet" href="public/css/styles.css">
  <link rel="stylesheet" href="public/css/modern-ui.css">
  <!-- 引入字体 -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <!-- 头部导航 -->
  <header class="header header-modern">
    <div class="container">
      <div class="nav">
        <div class="flex items-center">
          <!-- 移动端菜单按钮 -->
          <button id="menuBtn" class="btn btn-ghost btn-modern btn-ghost-modern md:hidden mr-2">
            <span class="icon-menu"></span>
          </button>
          
          <!-- Logo -->
          <a href="index.html" class="flex items-center gap-2 font-bold">
            <span class="icon-gamepad"></span>
            <span class="hidden md:block">游戏平台</span>
          </a>
        </div>
        
        <!-- 导航菜单 -->
        <nav class="hidden md:flex flex-1 justify-between items-center">
          <ul class="nav-menu">
            <li class="nav-item">
              <a href="index.html" class="nav-link nav-link-modern">首页</a>
            </li>
            <li class="nav-item" id="gameMenuTrigger">
              <a href="#" class="nav-link nav-link-modern">游戏中心</a>
            </li>
            <li class="nav-item">
              <a href="#" class="nav-link nav-link-modern">消息</a>
            </li>
            <li class="nav-item">
              <a href="tasks.html" class="nav-link nav-link-modern active">任务</a>
            </li>
          </ul>
          
          <div class="flex items-center gap-2">
            <!-- 搜索框 -->
            <div class="relative hidden md:flex w-40 lg:w-64">
              <span class="icon-search" style="position: absolute; left: 8px; top: 50%; transform: translateY(-50%);"></span>
              <input type="text" class="input input-modern pl-8" placeholder="搜索...">
            </div>
            
            <!-- 通知按钮 -->
            <button class="btn btn-ghost btn-modern btn-ghost-modern p-2">
              <span class="icon-bell"></span>
            </button>
            
            <!-- 移动端搜索按钮 -->
            <button class="btn btn-ghost btn-modern btn-ghost-modern p-2 md:hidden">
              <span class="icon-search"></span>
            </button>
            
            <!-- 用户头像 -->
            <div class="avatar avatar-modern">
              <img src="public/images/avatars/user1.jpg" alt="用户头像">
            </div>
          </div>
        </nav>
      </div>
    </div>
  </header>
  
  <!-- 侧边菜单 (移动端) -->
  <div id="sideMenu" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
    <div class="bg-background card-glass h-full w-4/5 max-w-sm p-4 transform transition-transform animate-slideUp">
      <div class="flex justify-between items-center mb-6">
        <h2 class="font-bold text-xl">菜单</h2>
        <button id="closeMenu" class="btn btn-ghost btn-modern btn-ghost-modern p-2">×</button>
      </div>
      
      <div class="grid gap-4">
        <a href="index.html" class="flex items-center gap-2 p-2 rounded hover:bg-muted">
          <span class="icon-home"></span>
          首页
        </a>
        <a href="#" class="flex items-center gap-2 p-2 rounded hover:bg-muted">
          <span class="icon-gamepad"></span>
          游戏中心
        </a>
        <a href="#" class="flex items-center gap-2 p-2 rounded hover:bg-muted">
          <span class="icon-message"></span>
          消息
        </a>
        <a href="#" class="flex items-center gap-2 p-2 rounded hover:bg-muted">
          <span class="icon-user"></span>
          个人资料
        </a>
        <a href="tasks.html" class="flex items-center gap-2 p-2 rounded hover:bg-muted">
          <span class="icon-trophy"></span>
          任务中心
        </a>
        
        <hr class="my-2 border-t border-muted">
        
        <a href="#" class="flex items-center gap-2 p-2 rounded hover:bg-muted">
          <span class="icon-settings"></span>
          设置
        </a>
        <a href="#" class="flex items-center gap-2 p-2 rounded hover:bg-muted">
          <span class="icon-logout"></span>
          退出登录
        </a>
      </div>
    </div>
  </div>
  
  <!-- 主要内容 -->
  <main class="pb-20">
    <div class="container py-6 animate-fadeIn">
      <div class="flex items-center justify-between mb-4">
        <h1 class="text-2xl font-bold">任务大厅</h1>
        <div class="flex items-center gap-2 card-glass px-4 py-2 rounded-full">
          <span class="text-sm">累计获得: </span>
          <span class="font-semibold flex items-center text-primary">
            <span class="icon-gem mr-1"></span>
            <span id="totalEarned">1200</span>
          </span>
        </div>
      </div>

      <div class="bg-primary/10 card-glass rounded-lg p-4 mb-6 flex justify-between items-center">
        <div>
          <span class="block text-sm mb-1">当前有大量可做任务</span>
          <span class="font-bold text-xl flex items-center">
            预计可以获得 <span class="icon-gem mx-1 text-primary"></span>
            <span class="text-primary" id="estimatedReward">8500</span>
          </span>
        </div>
        <button class="btn btn-primary btn-modern btn-primary-modern btn-sm" id="showRulesBtn">
          查看规则
        </button>
      </div>

      <!-- 任务标签页 -->
      <div class="mb-6">
        <div class="flex border-b mb-4">
          <button class="py-2 px-4 font-medium border-b-2 border-primary" id="allTasksTab">全部任务</button>
          <button class="py-2 px-4 font-medium text-muted border-b-2 border-transparent" id="recordsTab">任务记录</button>
        </div>
        
        <!-- 任务内容区域 -->
        <div id="taskContent">
          <!-- 抢单任务 -->
          <div class="space-y-4 mb-6 animate-slideUp">
            <div class="flex items-center justify-between">
              <h2 class="text-lg font-semibold">抢单任务</h2>
              <button class="btn btn-ghost btn-modern btn-ghost-modern btn-sm flex items-center" id="grabTaskRulesBtn">
                <span class="icon-refreshCw mr-1"></span>
                规则
              </button>
            </div>
            
            <div class="space-y-3" id="grabTasksList">
              <!-- 任务卡片会通过JS动态生成 -->
            </div>
          </div>
          
          <!-- 阶梯任务 -->
          <div class="space-y-4 mb-6 animate-slideUp" style="animation-delay: 0.1s">
            <div class="flex items-center justify-between">
              <h2 class="text-lg font-semibold">阶梯任务</h2>
              <button class="btn btn-ghost btn-modern btn-ghost-modern btn-sm flex items-center" id="ladderTaskRulesBtn">
                <span class="icon-refreshCw mr-1"></span>
                规则
              </button>
            </div>
            
            <div class="space-y-4" id="ladderTasksList">
              <!-- 任务卡片会通过JS动态生成 -->
            </div>
          </div>
          
          <!-- 一次性任务 -->
          <div class="space-y-4 animate-slideUp" style="animation-delay: 0.2s">
            <div class="flex items-center justify-between">
              <h2 class="text-lg font-semibold">一次性任务</h2>
              <button class="btn btn-ghost btn-modern btn-ghost-modern btn-sm flex items-center" id="oneTimeTaskRulesBtn">
                <span class="icon-refreshCw mr-1"></span>
                规则
              </button>
            </div>
            
            <div class="space-y-3" id="oneTimeTasksList">
              <!-- 任务卡片会通过JS动态生成 -->
            </div>
          </div>
        </div>
        
        <!-- 任务记录区域 (默认隐藏) -->
        <div id="recordsContent" class="hidden animate-fadeIn">
          <div class="grid gap-4" id="taskRecordsList">
            <!-- 任务记录会通过JS动态生成 -->
          </div>
          
          <div class="mt-4 text-center">
            <button class="btn btn-secondary btn-modern btn-secondary-modern" id="loadMoreRecordsBtn">加载更多</button>
          </div>
        </div>
      </div>
    </div>
  </main>
  
  <!-- 底部导航 -->
  <nav class="bottom-nav bottom-nav-modern">
    <div class="bottom-nav-content">
      <a href="index.html" class="bottom-nav-item bottom-nav-item-modern">
        <span class="icon-home"></span>
        <span class="bottom-nav-label">首页</span>
      </a>
      <a href="#" class="bottom-nav-item bottom-nav-item-modern">
        <span class="icon-gamepad"></span>
        <span class="bottom-nav-label">游戏</span>
      </a>
      <a href="#" class="bottom-nav-item bottom-nav-item-modern">
        <span class="icon-message"></span>
        <span class="bottom-nav-label">消息</span>
      </a>
      <a href="#" class="bottom-nav-item bottom-nav-item-modern">
        <span class="icon-user"></span>
        <span class="bottom-nav-label">我的</span>
      </a>
    </div>
  </nav>
  
  <!-- 规则弹窗 -->
  <div id="rulesModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="bg-background card-glass rounded-lg p-4 w-full max-w-md mx-4 animate-slideUp">
      <div class="flex justify-between items-center mb-4">
        <h3 class="font-bold text-lg" id="rulesModalTitle">任务规则</h3>
        <button id="closeRulesModal" class="btn btn-ghost btn-modern btn-ghost-modern p-2">×</button>
      </div>
      <div id="rulesModalContent" class="prose">
        <!-- 规则内容将通过JS动态设置 -->
      </div>
      <div class="mt-4 flex justify-end">
        <button id="confirmRulesModal" class="btn btn-primary btn-modern btn-primary-modern">我知道了</button>
      </div>
    </div>
  </div>
  
  <!-- 脚本 -->
  <script src="public/js/icons.js"></script>
  <script src="public/js/utils.js"></script>
  <script>
    // 等待DOM加载完成
    document.addEventListener('DOMContentLoaded', function() {
      // 初始化图标
      initIcons();
      
      // 加载任务数据
      loadTasks();
      
      // 绑定事件
      bindEvents();
    });
    
    // 初始化所有图标
    function initIcons() {
      // 菜单图标
      document.querySelectorAll('.icon-menu').forEach(el => {
        Icons.insert(el, 'menu', 20);
      });
      
      // 游戏手柄图标
      document.querySelectorAll('.icon-gamepad').forEach(el => {
        Icons.insert(el, 'gamepad2', 20);
      });
      
      // 首页图标
      document.querySelectorAll('.icon-home').forEach(el => {
        Icons.insert(el, 'home', 20);
      });
      
      // 消息图标
      document.querySelectorAll('.icon-message').forEach(el => {
        Icons.insert(el, 'messageCircle', 20);
      });
      
      // 用户图标
      document.querySelectorAll('.icon-user').forEach(el => {
        Icons.insert(el, 'user', 20);
      });
      
      // 奖杯图标
      document.querySelectorAll('.icon-trophy').forEach(el => {
        Icons.insert(el, 'trophy', 20);
      });
      
      // 设置图标
      document.querySelectorAll('.icon-settings').forEach(el => {
        Icons.insert(el, 'settings', 20);
      });
      
      // 退出图标
      document.querySelectorAll('.icon-logout').forEach(el => {
        Icons.insert(el, 'logOut', 20);
      });
      
      // 搜索图标
      document.querySelectorAll('.icon-search').forEach(el => {
        Icons.insert(el, 'search', 20);
      });
      
      // 通知图标
      document.querySelectorAll('.icon-bell').forEach(el => {
        Icons.insert(el, 'bell', 20);
      });
      
      // 宝石图标
      document.querySelectorAll('.icon-gem').forEach(el => {
        Icons.insert(el, 'gem', 16);
      });
      
      // 刷新图标
      document.querySelectorAll('.icon-refreshCw').forEach(el => {
        Icons.insert(el, 'refreshCw', 16);
      });
    }
    
    // 模拟任务数据
    const tasks = [
      {
        id: "1",
        title: "每日签到",
        description: "连续签到7天可获得额外奖励",
        reward: "100金币",
        progress: 5,
        total: 7,
        status: "进行中",
        icon: "public/images/tasks/signin.png"
      },
      {
        id: "2",
        title: "新手任务",
        description: "完成新手引导",
        reward: "新手礼包",
        progress: 1,
        total: 1,
        status: "已完成",
        icon: "public/images/tasks/guide.png"
      },
      {
        id: "3",
        title: "好友邀请",
        description: "邀请3位好友加入游戏",
        reward: "500金币",
        progress: 1,
        total: 3,
        status: "进行中",
        icon: "public/images/tasks/invite.png"
      },
      {
        id: "4",
        title: "等级提升",
        description: "将角色等级提升至10级",
        reward: "稀有装备",
        progress: 7,
        total: 10,
        status: "进行中",
        icon: "public/images/tasks/level.png"
      },
      {
        id: "5",
        title: "竞技场",
        description: "在竞技场中获得5场胜利",
        reward: "竞技场宝箱",
        progress: 3,
        total: 5,
        status: "进行中",
        icon: "public/images/tasks/arena.png"
      },
      {
        id: "6",
        title: "公会任务",
        description: "参与公会活动3次",
        reward: "公会贡献",
        progress: 0,
        total: 3,
        status: "未开始",
        icon: "public/images/tasks/guild.png"
      }
    ];
    
    const taskRecords = [
      {
        id: "r1",
        title: "每日签到",
        reward: 50,
        date: "2023-04-15 08:23",
        status: "已完成"
      },
      {
        id: "r2",
        title: "游戏时长2小时",
        reward: 120,
        date: "2023-04-14 20:11",
        status: "已完成"
      },
      {
        id: "r3",
        title: "绑定手机号",
        reward: 300,
        date: "2023-04-10 15:47",
        status: "已完成"
      },
      {
        id: "r4",
        title: "好友邀请",
        reward: 650,
        date: "2023-04-05 19:30",
        status: "已过期"
      }
    ];
    
    // 加载任务数据
    function loadTasks() {
      // 抢单任务
      const grabTasksList = document.getElementById('grabTasksList');
      tasks.forEach(task => {
        const taskCard = document.createElement('div');
        taskCard.className = 'card card-modern task-card p-4';
        
        taskCard.innerHTML = `
          <div class="flex justify-between items-start">
            <div>
              <h3 class="font-bold mb-1">${task.title}</h3>
              <p class="text-sm text-muted mb-2">${task.description}</p>
              <div class="flex items-center gap-2 mb-2">
                <span class="badge badge-modern badge-secondary-modern">${task.status}</span>
              </div>
              <div class="w-full mb-2">
                <div class="progress-bar">
                  <div class="progress-bar-fill" style="width: ${(task.progress / task.total) * 100}%"></div>
                </div>
                <div class="flex justify-between text-xs mt-1">
                  <span>${task.progress}/${task.total}</span>
                  <span>完成度: ${Math.round((task.progress / task.total) * 100)}%</span>
                </div>
              </div>
            </div>
            <div class="flex flex-col items-end">
              <div class="flex items-center text-primary font-bold mb-2">
                <span class="icon-gem mr-1"></span>
                <span>${task.reward}</span>
              </div>
              <button class="btn btn-primary btn-modern btn-primary-modern btn-sm" onclick="alert('已领取任务：${task.title}')">领取任务</button>
            </div>
          </div>
        `;
        
        grabTasksList.appendChild(taskCard);
      });
      
      // 任务记录
      const taskRecordsList = document.getElementById('taskRecordsList');
      taskRecords.forEach(record => {
        const recordItem = document.createElement('div');
        recordItem.className = 'card card-modern task-card p-4';
        
        recordItem.innerHTML = `
          <div class="flex justify-between">
            <div>
              <h3 class="font-bold mb-1">${record.title}</h3>
              <span class="text-xs text-muted">${record.date}</span>
            </div>
            <div class="flex flex-col items-end">
              <div class="flex items-center text-primary font-bold mb-1">
                <span class="icon-gem mr-1"></span>
                <span>${record.reward}</span>
              </div>
              <span class="text-xs ${record.status === '已完成' ? 'text-primary' : 'text-muted'}">${record.status}</span>
            </div>
          </div>
        `;
        
        taskRecordsList.appendChild(recordItem);
      });
      
      // 重新初始化宝石图标
      document.querySelectorAll('.icon-gem').forEach(el => {
        Icons.insert(el, 'gem', 16);
      });
    }
    
    // 绑定事件
    function bindEvents() {
      // 菜单按钮点击事件
      const menuBtn = document.getElementById('menuBtn');
      const closeMenuBtn = document.getElementById('closeMenu');
      const sideMenu = document.getElementById('sideMenu');
      
      menuBtn.addEventListener('click', () => {
        sideMenu.classList.remove('hidden');
      });
      
      closeMenuBtn.addEventListener('click', () => {
        sideMenu.classList.add('hidden');
      });
      
      // 标签页切换
      const allTasksTab = document.getElementById('allTasksTab');
      const recordsTab = document.getElementById('recordsTab');
      const taskContent = document.getElementById('taskContent');
      const recordsContent = document.getElementById('recordsContent');
      
      allTasksTab.addEventListener('click', () => {
        allTasksTab.classList.add('border-primary');
        allTasksTab.classList.remove('text-muted', 'border-transparent');
        
        recordsTab.classList.remove('border-primary');
        recordsTab.classList.add('text-muted', 'border-transparent');
        
        taskContent.classList.remove('hidden');
        recordsContent.classList.add('hidden');
      });
      
      recordsTab.addEventListener('click', () => {
        recordsTab.classList.add('border-primary');
        recordsTab.classList.remove('text-muted', 'border-transparent');
        
        allTasksTab.classList.remove('border-primary');
        allTasksTab.classList.add('text-muted', 'border-transparent');
        
        recordsContent.classList.remove('hidden');
        taskContent.classList.add('hidden');
      });
      
      // 规则弹窗
      const rulesModal = document.getElementById('rulesModal');
      const closeRulesModal = document.getElementById('closeRulesModal');
      const confirmRulesModal = document.getElementById('confirmRulesModal');
      const rulesModalTitle = document.getElementById('rulesModalTitle');
      const rulesModalContent = document.getElementById('rulesModalContent');
      
      // 显示规则弹窗的函数
      function showRulesModal(title, content) {
        rulesModalTitle.textContent = title;
        rulesModalContent.innerHTML = content;
        rulesModal.classList.remove('hidden');
      }
      
      // 关闭规则弹窗
      function closeModal() {
        rulesModal.classList.add('hidden');
      }
      
      closeRulesModal.addEventListener('click', closeModal);
      confirmRulesModal.addEventListener('click', closeModal);
      
      // 显示不同类型任务的规则
      document.getElementById('showRulesBtn').addEventListener('click', () => {
        showRulesModal('任务规则总览', `
          <p>通过完成任务可以获得平台奖励，奖励可用于兑换多种礼品或游戏内道具。</p>
          <p><strong>任务类型：</strong></p>
          <ul>
            <li><strong>抢单任务：</strong> 限时任务，必须在规定时间内完成。</li>
            <li><strong>阶梯任务：</strong> 完成不同阶段，获得不同级别的奖励。</li>
            <li><strong>一次性任务：</strong> 完成即可获得全部奖励，无时间限制。</li>
          </ul>
          <p>请注意，部分任务可能有特殊要求，详见具体任务说明。</p>
        `);
      });
      
      document.getElementById('grabTaskRulesBtn').addEventListener('click', () => {
        showRulesModal('抢单任务规则', `
          <p>抢单任务是限时任务，必须在规定时间内完成。</p>
          <p><strong>规则说明：</strong></p>
          <ul>
            <li>任务有效期内可随时领取</li>
            <li>未能在截止时间前完成将失效</li>
            <li>部分高难度任务奖励更丰厚</li>
          </ul>
          <p>完成任务进度可实时查看，达到100%后可领取奖励。</p>
        `);
      });
      
      document.getElementById('ladderTaskRulesBtn').addEventListener('click', () => {
        showRulesModal('阶梯任务规则', `
          <p>阶梯任务可以分阶段完成，每个阶段都有对应奖励。</p>
          <p><strong>规则说明：</strong></p>
          <ul>
            <li>无需一次完成所有阶段</li>
            <li>已领取的阶段奖励不会重复发放</li>
            <li>阶段之间相互独立，可单独领取</li>
          </ul>
          <p>请根据自己的情况选择合适的目标阶段。</p>
        `);
      });
      
      document.getElementById('oneTimeTaskRulesBtn').addEventListener('click', () => {
        showRulesModal('一次性任务规则', `
          <p>一次性任务只需完成一次即可获得奖励。</p>
          <p><strong>规则说明：</strong></p>
          <ul>
            <li>大多数为平台基础任务</li>
            <li>无时间限制，可随时完成</li>
            <li>部分特殊任务可能有额外要求</li>
          </ul>
          <p>完成后奖励将直接发放到您的账户。</p>
        `);
      });
      
      // 加载更多记录
      document.getElementById('loadMoreRecordsBtn').addEventListener('click', function() {
        this.textContent = '加载中...';
        setTimeout(() => {
          this.textContent = '已加载全部';
          this.disabled = true;
          this.classList.add('opacity-50');
        }, 1000);
      });
    }
  </script>
</body>
</html> 